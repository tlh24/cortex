(menhir
	(modules parser))

(ocamllex lexer)

(rule
	(targets
		logo_pb.ml
		logo_pb.mli
		logo_pp.ml
		logo_pp.mli
		logo_types.ml
		logo_types.mli
	)
	(deps logo.proto)
	(action
	(progn
		(run ocaml-protoc -I /usr/include -binary -pp -ml_out ./ %{deps} )
		(bash "rm -rf logod_pb2.py logod.proto")
		(bash "cat logo.proto | ./logo_proto_filter.pl > logod.proto")
		(bash "protoc --python_out=./ logod.proto")
		(bash "cp logod_pb2.py ../../logod_pb2.py")
	))
)

(executable
	(name program)
	(modules logo_pb logo_pp logo_types logo parser lexer vgwrapper colors program)
	(libraries core core_unix.command_unix vg vg.cairo pbrt)
	)
